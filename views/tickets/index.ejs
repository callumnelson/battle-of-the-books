<%- include('../partials/html-head') %>
<link rel="stylesheet" href="/stylesheets/tickets/index.css">
<script defer src="/js/tickets/index.js"></script>
<%- include('../partials/nav') %>

<main>
  <section class="page-header-container">
    <div>
      <h1 class="page-header">Tickets</h1>
    </div>
    <div class="page-nav-container">
      <a class="btn btn-outline-info" role="button" id="new-ticket-btn">
        Submit a Ticket
      </a>
    </div>
  </section>
  <section class="content-container">
    <h3>Pending Tickets (<%= student.tickets.length %>) </h3>
    <table id="tickets-list" class="table">
      <thead class="thead-light">
        <tr>
          <th scope="col">#</th>
          <th scope="col">Title</th>
          <th scope="col">Author(s)</th>
          <th scope="col"># Pages</th>
          <th scope="col"></th>
        </tr>
      </thead>
      <tbody>
        <% student.tickets.forEach( (ticket, i) => { %>
          <tr>
            <th scope="row"><%= i+1 %></th>
            <td> <%= ticket.book.title %> </td>
            <td> 
              <%= ticket.book.authors.length > 1 ? ticket.book.authors.join(', ') : ticket.book.authors[0]%> 
            </td>
            <td> <%= ticket.book.pageCount %> </td>
            <td>
              <a href="/tickets/<%= ticket._id %>" role="button" class="btn btn-outline-primary">
                Details
              </a>
            </td>
            <td>
              <form action="/tickets/<%= ticket._id %>/profiles/<%= user.profile._id %>?_method=DELETE" method="POST" class="delete-form">
                <input role="button" type="submit" value="Delete" class="btn btn-outline-danger">
                </input>
              </form>
            </td>
          </tr>
        <% }) %>
      </tbody>
    </table>
  </section>

  <section id="new-ticket-modal" class="modal-custom">
    <div class="modal-wrapper">
      <div class="modal-header">
        <h3>New Ticket</h3>
        <span id="close-ticket-modal" class="close">X</span>
      </div>
      <div class="modal-content">
        <form action="/tickets" method="POST">
          <div class="form-group">  
            <label for="title-input">Title</label>
            <input type="text" class="form-control" name="title" id="title-input" required>
          </div>
          <div class="form-group">
            <label for="author-input">Author</label>
              <input class="form-control" type="text" name="author" id="author-input" required>
          </div>
          <div class="form-group">
            <label for="pageCount-input"># Pages</label>
              <input class="form-control" type="number" name="pageCount" id="pageCount-input" min="0" max="2000" required>
          </div>
          <div class="form-group">
            <label for="review-input">Write a Review:</label>
              <textarea class="form-control" type="text" name="review" id="review-input" required></textarea>
          </div>
          <button type="submit" class="btn btn-success">
            Submit Ticket
          </button>
        </form>
      </div>
    </div>
  </section>
</main>

<%- include('../partials/footer') %>
